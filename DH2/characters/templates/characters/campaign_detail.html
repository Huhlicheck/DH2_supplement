<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Your Characters</title>
</head>
<body>
    {% block content %}
    <h1>{{ campaign.name }}</h1>
    <p>{{ campaign.description }}</p>
    <p>Campaign Master: {{ campaign.campaign_master.username }}</p>
    
    <h2>Characters in Campaign</h2>
    <ul>
        {% for character in campaign_characters %}
            <li>
                <a href="{% url 'characters:character_detail' character.name %}">{{ character.name }}</a> 
                (Experience Total: {{ character.experience_total }})
                
                {% if is_master %}
                    <!-- Assign Experience Points Form for Individual Character -->
                    <form method="post" style="display:inline;">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="assign_experience">
                        <input type="hidden" name="character_id" value="{{ character.id }}">
                        <label for="experience_points_{{ character.id }}">Experience Points:</label>
                        <input type="number" name="experience_points" id="experience_points_{{ character.id }}" required>
                        <button type="submit">Assign</button>
                    </form>
                    
                    <!-- Remove Character from Campaign Form -->
                    <form method="post" style="display:inline;">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="remove_character">
                        <input type="hidden" name="character_id" value="{{ character.id }}">
                        <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to remove this character from the campaign?');">Remove</button>
                    </form>
                {% endif %}
            </li>
        {% endfor %}
    </ul>
    
    {% if is_master %}
        <h2>Assign Experience Points to All Characters</h2>
        <form method="post">
            {% csrf_token %}
            <input type="hidden" name="action" value="assign_experience_to_all">
            <label for="experience_points_all">Experience Points for All Characters:</label>
            <input type="number" name="experience_points" id="experience_points_all" required>
            <button type="submit">Assign to All Characters</button>
        </form>
    {% endif %}
    

    <!-- Request to Join Campaign (for user's characters not in campaign) -->
    <h2>Your Characters Not in Campaign</h2>
    <ul>
        {% for character in user_characters %}
            <li>
                <a href="{% url 'characters:character_detail' character.name %}">{{ character.name }}</a>
                <form method="post" style="display:inline;">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="request_to_join">
                    <input type="hidden" name="character_id" value="{{ character.id }}">
                    <button type="submit">Request to Join</button>
                </form>
            </li>
        {% endfor %}
    </ul>

    <!-- Pending Requests (Master only) -->
    {% if is_master and pending_requests %}
        <h2>Pending Join Requests</h2>
        <ul>
            {% for request in pending_requests %}
                <li>
                    <a href="{% url 'characters:character_detail' request.name %}">{{ request.name }}</a> (from {{ request.player.username }})
                    <form method="post" style="display:inline;">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="approve_request">
                        <input type="hidden" name="character_id" value="{{ request.id }}">
                        <button type="submit">Approve</button>
                    </form>
                    <form method="post" style="display:inline;">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="decline_request">
                        <input type="hidden" name="character_id" value="{{ request.id }}">
                        <button type="submit">Decline</button>
                    </form>
                </li>
            {% endfor %}
        </ul>
    {% endif %}

    {% endblock %}

<p><a href="{% url 'characters:character_list' %}">Back to Character List</a></p>

</body>
</html>
